<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">
  <title>Shoe Vault</title>
  <meta name="keywords" content="">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="landing.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="responsive.css">
  <link rel="stylesheet" href="jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/font-awesome.css">
  <link rel="stylesheet" href="owl.carousel.min.css">
  <link rel="stylesheet" href="owl.theme.default.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css"
    media="screen">
</head>
<%- include('../partials/user/header.ejs') %>

  <body>

    <main class="py-40">

      <style>
        .filter-section {
          display: flex;
          justify-content: flex-end;
          color: #0d8507;
          height: 40px;
          margin-right: 80px;
        }

        select {
          padding: 8px -12px;
          border: 1px solid #ddd;
          border-radius: 4px;
          background-color: rgb(255, 255, 255);
          font-size: 14px;
          padding-left: 51px;
          cursor: pointer;
          min-width: 200px;
        }

        select:focus {
          outline: none;
          border-color: #1b5605;
        }

        .product-item {
          border: 1px solid #eee;
          padding: 15px;
          margin-bottom: 15px;
          border-radius: 4px;
          transition: box-shadow 0.3s ease;
        }

        .product-item:hover {
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .product-item h3 {
          margin: 0 0 10px 0;
          font-size: 18px;
        }

        .product-item p {
          margin: 0;
          color: #007bff;
          font-weight: bold;
        }

        #product-list {
          padding: 30px;
        }


        .search-container {
          display: flex;
          align-items: center;
          border-radius: 4px;
          margin-right: 10px;
          padding: 5px;
          width: 300px;
        }

        .search-input {
          flex-grow: 1;
          border-radius: 7px;
          background-color: rgb(92, 85, 85);
          outline: none;
          padding: 5px;
          font-size: 16px;
        }

        .search-button {
          background: #ff7b00;
          border: none;
          cursor: pointer;
          border-radius: 7px;
          padding: 5px;
          font-size: 16px;
        }
      </style>
      <div>
        <input type="text" class="search-input" id="search-input" placeholder="Search...">
        <button type="button" class="search-button" id="search-button" onclick="search()">üîç</button>
      </div>

      <div class="filter-section">
        <select id="sort-filter" onchange="applyFilter()" aria-label="Sort products">
          <option value="">Filter Products</option>
          <option value="price-asc">Price: Low to High</option>
          <option value="price-desc">Price: High to Low</option>
          <option value="name-asc">Name: A to Z</option>
          <option value="name-desc">Name: Z to A</option>
        </select>
      </div>

      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4" id="product-list">
        <% if (Array.isArray(products) && products.length> 0) { %>
          <% products.forEach((product)=> { %>
            <div class="col animate-on-scroll" data-price="<%= product.salePrice %>"
              data-name="<%= product.productName %>">
              <div class="card h-100 glass border-0 shadow-md hover:shadow-lg transition duration-300">
                <a href="/productDetails?product=<%= product._id %>" class="block">
                  <img src="/uploads/product-images/<%= product.productImage[0] %>" class="card-img-top rounded-top"
                    alt="<%= product.productName %>">
                  <div class="card-body text-center">
                    <h5 class="card-title text-lg font-semibold mb-2 text-black">
                      <%= product.productName %>
                    </h5>
                    <p class="card-text text-accent font-bold mb-4">‚Çπ<%= product.salePrice %>
                    </p>
                    <p class="card-text text-accent font-bold mb-4">
                      <%= product.brandName %>
                    </p>
                    <a href="/cart/add/?productId=<%= product._id %>"
                      class="modern-btn btn btn-black bg-black hover:bg-opacity-80 text-light transition duration-300">Add
                      to Cart</a>
                  </div>
                </a>
              </div>
            </div>
            <% }) %>
              <% } else { %>
                <div class="col-12 text-center">
                  <p class="text-secondary font-medium text-xl">No products available at the moment. Please check back
                    later!</p>
                </div>
                <% } %>
      </div>
    </main>

    <%- include('../partials/user/footer.ejs') %>
  </body>

</html>
<script>
  document.querySelectorAll(".add-to-cart-btn").forEach(button => {
    button.addEventListener("click", async (event) => {
      const productId = event.target.dataset.productId;

      const response = await fetch("/cart/add", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ productId })
      });
    });
  });

  // filter section
  function applyFilter() {
    const sortFilter = document.getElementById('sort-filter').value;
    const productList = document.getElementById('product-list');
    const products = Array.from(productList.getElementsByClassName('col'));

    products.sort((a, b) => {
      const aPrice = parseFloat(a.dataset.price);
      const bPrice = parseFloat(b.dataset.price);
      const aName = a.dataset.name;
      const bName = b.dataset.name;

      switch (sortFilter) {
        case 'price-asc':
          return aPrice - bPrice;
        case 'price-desc':
          return bPrice - aPrice;
        case 'name-asc':
          return aName.localeCompare(bName);
        case 'name-desc':
          return bName.localeCompare(aName);
        default:
          return 0;
      }
    });
    products.forEach(product => productList.appendChild(product));
  }
  // search


</script>